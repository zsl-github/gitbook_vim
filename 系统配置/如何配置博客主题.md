---
title: 如何配置博客Next主题
date: 2017-03-01 19:22:18
tags: 系统配置
categories:
    - 博客
    - 
password:
---

# Next 主题

使用`github`跟`Hexo`搭建好博客以后，需要给博客设置一个主题，看网上说的`next`主题不错，就先体验下它了。

# 安装主题

在`github`上下载主题[next](https://github.com/iissnan/hexo-theme-next),然后拷贝到博客的`theme`下
或者直接用`git`命令下载
```
git clone git@github.com:iissnan/hexo-theme-next.git
```

然后在博客的`_config.yml`中把主题设置为`hexo-theme-next`的名称

# next主题样式修改

## 主题修改

通过修改next主题下的`_config.yml`中的`scheme`内容来更改菜单

```
# Schemes
scheme: Muse
#scheme: Mist
#scheme: Pisces
#scheme: Gemini
```
各个主题效果图如下

**Muse**

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/scheme_Muse.png)

**Mist**

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/scheme_Mist.png)

**Pisces**

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/scheme_Pisces.png)

**Gemini**
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/scheme_Gemini.png)

默认主题是`Muse`，也是我比较喜欢的主题-因为我喜欢简简单单，不喜欢太复杂的东西

## 修改主界面

通过修改next主题下的`_config.yml`中的`menu`内容来更改菜单

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/next_theme_menu.png)

使用上面的方法在主页中显示`标签`，但是点击主题中的`标签`，会报404的错误

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/boke_zhuti_biaoqian_404.png)

解决方案如下

直接在`Hexo`目录下执行如下命令

```
hexo new page tags
```

这个命令会在`source`下生成一个`tags`文件夹，而且文件夹中会生成`index.md`文件，进入此文件，然后更改成如下内容即可

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/boke_zhuti_biaoqian_xiugai.png)

## 设置预览摘要

我们还是直接看修改前后的效果图吧，比较直观

**修改前**
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/yulan_1.png)

**修改后**

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/yulan_2.png)

**修改方法**
在`next`的配置文件-`_config.yml`中搜索`auto_excerpt`，内容如下

```
auto_excerpt:
  enable: false
  length: 150
```
打开`enable`为`true`即可
`length`-表示预览字数

```
auto_excerpt:
  enable: true
  length: 150
```

## 设置分类

目前还不大清楚`分类`跟`标签`到底有什么区别，主要说的是它们在分类管理中。二者的优势还是等到使用一段时间后在总结吧，这里先记录下配置方法

先上图
![分类效果图](https://github.com/zsl-github/blog/raw/master/source/picture/categories.png)

**修改方法**

1. 在`next`的配置文件-`_config.yml`中搜索`categories`，内容如下

```
menu:
  home: / || home
  about: /about/ || user
  tags: /tags/ || tags
  categories: /categories/ || th
```

去掉分类注释即可

2. 创建索引文件

执行如下命令
```
hexo new page categories
```
会生成一个`index.md`文件

> source/categories/index.md            

然后添加如下内容
```
types: "categories"
```

3. 使用

在创建文件的时候，添加分类方法如下

```
---
title: 如何配置博客Next主题
date: 2017-08-30 19:22:18
tags: 系统配置
categories:
    - 工具
    - 博客
---

```

## 修改文章内链接文本样式

默认文本链接效果如图

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/lianjie_old.png)

显示不明显,而且不美观,修改后效果图

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/lianjie_new.png)

明显舒服多了

**实现方法**

在 主题下的`source/css/_common/components/post/post.styl` 中添加如下内容即可

```
//zsl add begin 
// 文章内链接文本样式
.post-body p a{
  color: #0593d3;
  border-bottom: none;
  border-bottom: 1px solid #0593d3;
  &:hover {
    color: #fc6423;
    border-bottom: none;
    border-bottom: 1px solid #fc6423;
  }
}
//zsl add end 
```

## 添加热度

先看效果图

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/redu_1.png)

**实现方法**
1. 在主题下的`layout/_macro/post.swig`如下代码中,添加`<span>°C</span>`
```
{# LeanCould PageView #}
{% if theme.leancloud_visitors.enable %}
 <span id="{{ url_for(post.path) }}" class="leancloud_visitors" data-flag-title="{{ post.title }}">
   <span class="post-meta-divider">|</span>
   <span class="post-meta-item-icon">
     <i class="fa fa-eye"></i>
   </span>
   {% if theme.post_meta.item_text %}
     <span class="post-meta-item-text">{{__('post.visitors')}}&#58;</span>
   {% endif %}
     <span class="leancloud-visitors-count"></span>
   {# zsl add begin #}
   <span>°C</span>
   {# zsl add end #}
 </span>
{% endif %}
```
2. 更改主题下的`languages/zh-Hans.yml`的如下内容-`visitors`字串内容为`热度`

```
untitled: 未命名
toc_empty: 此文章未包含目录
visitors: 热度
wordcount: 字数统计
min2read: 阅读时长

```

## 更改底部状态信息

在博客底部,默认显示如下

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/qiangliqudong_old.png)

**去除强力驱动提示**
底部的强力驱动提示感觉可以替换为更有用的信息,所以先隐藏他们,直接注释掉`layout/_partials/footer.swig`中的如下内容即可

```
<!-- zsl delete the code for hide 底部驱动
  <div class="powered-by">{#
  #}{{ __('footer.powered', '<a class="theme-link" href="https://hexo.io">Hexo</a>') }}{#
#}</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">{#
  #}{{ __('footer.theme') }} &mdash; {#
  #}<a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">{#
    #}NexT.{{ theme.scheme }}{#
  #}</a> v{{ theme.version }}{#
#}</div>
-->
```

**添加访客数**

在`layout/_partials/footer.swig`中`copyright`前添加如下内容(注释包裹部分)

```
<!-- zsl add for 访客数 -->
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- zsl add for 访客数 -->
<div class="copyright" >
```
在`layout/_partials/footer.swig`中合适位置添加如下代码(注释包裹部分)

```
    <span title="{{ __('post.totalcount') }}">
      {{ totalcount(site, '0,0.0a') }}
    </span>
  {% endif %}
</div>

<!-- zsl add for 访客数 -->
<div class="powered-by">
  <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
    本站访客数:<span id="busuanzi_value_site_uv"></span>
  </span>
</div>

<!-- zsl add for 访客数 -->

{% if theme.copyright %}
<!-- zsl delete the code for hide 底部驱动
```

效果图

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/qiangliqudong_new.png)

## 加密访问

这个是自己比较需要的功能,因为自己的博客里会有一些类似反省类的日记,还是比较私密的,这个还是有点用的,虽然在`github`中可以一览无遗.

先看下效果


![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/jiami_1.gif)

**具体方法**

在`layout/_partials/head.swig`中添加如下内容(注释间内容)

```
<meta name="theme-color" content="{{ theme.android_chrome_color }}">

<!-- zsl add for 加密 -->
<script>
    (function(){
        if('{{ page.password }}'){
            if (prompt('请输入文章密码') !== '{{ page.password }}'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>
<!-- zsl add for 加密 -->

{% if theme.pace %}
```

**如何使用**
只需在文章头添加如下内容

```
password: ****
```
例如

```
tags: 系统配置
categories:
    - Hexo
    - 主题
password: test
```

## 添加打赏功能
经常看别人的博客有一个二维码可以用来打赏，我当然不指望靠他发家致富，只是感觉如果偶尔有人能给你的东西支持一下，确实会让自己稍稍自豪一下，也能让自己更容易坚持下去

先看效果图

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/dashang.png)

**实现方法**

1. 获取二维码

我们以微信为例，可以在收付款中获得二维码，具体可参考
[获取微信二维码](http://jingyan.baidu.com/article/b907e627b641b646e6891c6b.html)

把获取的二维码图片放到主题的`images`目录下

> themes/next/source/images/

2. 配置主题文件

在`next`的配置文件-`_config.yml`中搜索`wechatpay`，内容如下

```
#reward_comment: Donate comment here
#wechatpay: /images/wechatpay.jpg
```
修改为

```
reward_comment: 您的支持，是我最大的动力
wechatpay: https://github.com/zsl-github/blog/raw/master/source/picture/wechatpay.png
```

## 收录百度、谷歌搜索

现在我的博客在百度搜索中是看不到的，看网上的说法是需要进行认证，具体方法如下

### 百度

**1. 登录站长平台**

进入[百度站长平台](http://zhanzhang.baidu.com/site)，点击`站点管理`-> `添加网站`

![站长平台](https://github.com/zsl-github/blog/raw/master/source/picture/zhanzhang.png)

**2. 添加网站**

填入自己的域名,如我的是`www.zsl1989.com`
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/tianjiazhandian_1.png)

选择自己的站点属性

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/tianjiazhandian_2.png)

选择认证方式

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/tianjiazhandian_3.png)

**3. 认证**
三个认证方式中`CNAME`认证最简单，所以我选择了这个

1. 登录自己的域名管理网址，我的是从`腾讯云`购买的，然后在`域名服务` -> `域名管理`中，选择自己的域名，然后`解析` -> `添加记录` 填写内容如下，即可

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/tianjiazhandian_4.png)

稍等几分钟，点击`百度站点`的`完成认证` 即可

**百度搜索结果**

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/baidu_blog.png)


### Google

方法跟百度类似，具体如下

加录地址
[谷歌加录地址](www.google.com/webmasters/)

`Google`我选用的是`HTML tag`方式

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/google_zhandian_1.png)

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/google_zhandian_2.png)

找到`Next`主题下的`_config.yml`的如下内容
```
google_site_verification: 
```
把网站提供的`content`填入上述内容即可

虽然已经能`site`成功了，但是在百度中还是搜不到自己的博客，这时候还需要关键的一步-添加站点地图

## 如何添加站点地图

**1. 安装MAP插件**

执行如下命令安装

```
npm install hexo-generator-sitemap --save
npm install hexo-generator-baidu-sitemap --save
```

**2. 配置主题文件**

在`主题配置文件`中添加如下内容

```
sitemap:
  path: sitemap.xml
baidusitemap:
  path: baidusitemap.xml
```
这样在你执行`hexo g`以后，就会在`public`下生成如下两个文件
- sitemap.xml 公用站点地图,由hexo-generator-sitemap生成
- baidusitemap.xml 百度专用站点地图,由hexo-generator-baidu-sitemap生成

备注:亲测发现，不用添加上述内容也行

这时候你去谷歌应该就能搜到自己的博客记录了

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/google_map_error_1.png)

**3. 问题**
你会发现点击google中搜索到的博客地址会报`404`错误，仔细对比搜索到的地址你会发现，它跟实际地址不一样

搜索到的地址

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/google_map_error_2.png)


实际地址
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/google_map_error_3.png)

很奇怪，每次搜索的结果网址都不一样，后来自己就好了。不过，有一点是确定的，就是网址跟标题以及`data`是直接相关的。所以，还是
要养成一个好习惯，就是创建新博客的时候，标题一次定好，创建时间也要写上，尽量避免后续修改

## 添加阅读次数统计

**1.注册/登录LeanCloud账号**

进入[LeanCloud](https://leancloud.cn/),进行注册-点击`访问控制台`

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_1.png)

进行登录,我用的是`github`账号

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_2.png)

**2.创建新应用**

选择`创建新应用`
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_3.png)

选择`开发板`,然后填入`新应用名称`

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_4.png)

**3.创建Class**

选择上面创建的应用,然后点击`存储`

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_5.png)

点击`创建Class`

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_7.png)

勾选`无限制`,填入`Class`名称
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_8.png)

**4.获取KEY值**

点击`设置`->`应用key`

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_9.png)

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/LC_10.png)

**5.添加到Hexo配置文件中**

找到`Next`主题下的`_config.yml`的如下内容

```
leancloud_visitors:
  enable: true
  app_id: 
  app_key:
```
然后把上面的`enable`更改为`true`,把在`leancloud`中获得的值拷贝到`app_id`跟`app_key`中

重新生成静态网页就好了

## 添加本地搜索

**1. 安装 hexo-generator-searchdb**

在站点的根目录下执行以下命令：

```
npm install hexo-generator-searchdb --save
```

**2. 编辑站点配置文件**
新增以下内容到任意位置：

```
    search:
      path: search.xml
      field: post
      format: html
      limit: 10000

```
**启用本地搜索功能**

搜索关键字`local_search`如下

```
    # Local search
    local_search:
      enable: true

```
把`enable`更改为`true`

光进行到上面这些还不行，还需要如下`Algolia`的支持才行

## Algolia 搜索

站内搜索插件,先看效果图

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_search.gif)

具体方法

**1. 注册Algolia 创建index**

前往[Algolia 注册页面](https://www.algolia.com/)注册一个新账户,可以使用 GitHub 或者 Google 账户直接登录
创建一个`index`

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_1.png)

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_2.png)

**2. 安装Hexo Algolia 插件**

Index 创建完成后，此时这个 Index 里未包含任何数据。 接下来需要安装 Hexo Algolia 扩展， 这个扩展的功能是搜集站点的内容并通过 API 发送给 Algolia。前往站点根目录，执行命令安装：

```
npm install --save hexo-algolia
```

**3. 获取Key 更新配置**

在 `Algolia` 服务站点上找到需要使用的一些配置的值，包括 `ApplicationID`、`Search API Key`、 `Admin API Key`。我们只需要用到前面两个


![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_3.png)

注意,配置文件是站点目录下的配置文件,而不是主题下的,我当时就是在主题下的`_config.yml`进行配置,结果怎么调都不生效,后来根据错误信息看源码才找到
原因

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_4.png)

解释下上面的几个`key`值


![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_5.png)

**4. 配置环境变量**

[hexo-algolia](https://github.com/oncletom/hexo-algolia)中提到,

> A separate API Key must be provided as an environment variable named HEXO_ALGOLIA_INDEXING_KEY. Create it with these limited write access permissions: Add records, Delete records, List indices, Delete index.

具体操作

1. 创建一个特殊的`Key`
![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_6.png)

一定要勾选图中的四个权限


![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/algolia_7.png)

2. 设置环境变量

执行如下命令

```
export HEXO_ALGOLIA_INDEXING_KEY=…
```
省略号是你创建的特殊`key`的值

**5. 更新index**

当配置完成，在站点根目录下执行 `hexo algolia` 来更新 Index

**6. 主题集成**

更改主题配置文件，找到 `Algolia Search` 配置部分,将 `enable` 改为 `true` 即可

```
# Algolia Search
algolia_search:
  enable: false
  hits:
    per_page: 10
  labels:
    input_placeholder: Search for Posts
    hits_empty: "We didn't find any results for the search: ${query}"
    hits_stats: "${hits} results found in ${time} ms"
```


**7-12**
最近忽然发现`hexo`不能解析了，后来发现是主题`next`丢了，重新下载新的主题就可以了

**官方文档**
最后附上官方使用文档

[Next 文档](http://theme-next.iissnan.com/getting-started.html)
