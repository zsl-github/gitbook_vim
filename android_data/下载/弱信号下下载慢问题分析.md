---
title: 下载慢问题分析
date: 2017-04-20 09:30:39
tags: android
categories:
    - 下载
    - 场测
password: 
---

# 问题描述
在场测中经常会遇到下载慢的问题，这类问题，主要是从网络侧来分析原因，现记录下大致的分析思路，如下

# 问题分析

## 服务器地址影响下载速度

通过`wireshark`查看下载路径


在`LOG`中我们点击一下`Protocol`让它按照这个字段来排序，然后找到`HTTP`中`GET`的内容：

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/download_slow_1.png)

里面可以看到下载的`kugou`的请求

```
22592	2017-11-16 11:25:49.793369	10.130.188.230	112.29.152.46	HTTP	359	GET /dd.myapp.com/16891/4D9B02524BFC1FA91C0CD8AF7413BCA2.apk?mkey=5a0d23c997014e2a&f=8f5d&c=0&fsname=com.kugou.android_8.9.2_8921.apk&__k1__=y&cip=223.104.1.151&p=.apk HTTP/1.1 HTTP
```

然后我们选择这一行，点开`Hypertext Transfer Protocol`,就可以看到下载请求的地址了

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/download_slow_2.png)

查看结束时间,标志位是`FIN`

```
22934	2017-11-16 11:26:00.472665	10.212.20.104	112.29.152.47	TCP	68	49426 → http(80) [FIN, ACK] Seq=308 Ack=3257190 Win=984576 Len=0 TSval=32050 TSecr=16249153
```


## 不同小区影响下载速度

### QC

直接在`QCAT`搜索`0XB193`，结果如下


```
2017 Nov 16  03:39:22.619  [7B]  0xB193  LTE ML1 Serving Cell Meas Response
Version              = 1
Number of SubPackets = 1
SubPacket ID         = 25
Serving Cell Measurement Result
   Version = 18
   SubPacket Size = 96 bytes
   E-ARFCN                   = 39148//相对无线频道编号,通过它可以查询对应的频率以及band
   Physical Cell ID          = 251  //小区
   Serving Cell Index        = PCell
   Is Serving Cell = 1
   Reserved = 0
   Current SFN               = 734
   Current Subframe Number   = 2
   Is Restricted             = false
   Cell Timing[0]            = 158496
   Cell Timing[1]            = 158496
   Cell Timing SFN[0]        = 734
   Cell Timing SFN[1]        = 734
   Inst RSRP Rx[0]           = -77.88 dBm
   Inst RSRP Rx[1]           = -94.56 dBm
   Inst Measured RSRP        = -77.88 dBm
   Inst RSRQ Rx[0]           = -4.50 dB
   Inst RSRQ Rx[1]           = -5.00 dB
   Inst RSRQ                 = -4.50 dB
   Inst RSSI Rx[0]           = -53.38 dBm
   Inst RSSI Rx[1]           = -69.50 dBm
   Inst RSSI                 = -53.38 dBm

```


### MTK

搜索关键字`Serv cell`既可以查看所处频点跟小区等信息

```
3487813, 98794, 86823, 11:39:43:700 2017/11/16, MOD_ERRC_MOB, , TRACE_GROUP_1, [MRM] Serv cell: earfcn[39148] pci[251] srxlev[153], squal[32767], hps[1]
3488329, 99061, 87090, 11:39:45:055 2017/11/16, MOD_ERRC_MOB, , TRACE_GROUP_1, [MRM] Serv cell: earfcn[39148] pci[251] srxlev[153], squal[32767], hps[1]
```

## 信号质量影响下载速度

### QC

直接在`QCAT`搜索`0XB193`，结果如下

### MTK

通过ELT工具查看

搜索关键字`store scell: earfcn`

```
3701404, 118773, 104544, 11:24:26:135 2017/11/16, MOD_ERRC_MOB, , TRACE_GROUP_1, [MRM] store scell: earfcn[38950] pci[248] rsrp2[-350] rssnr[124]

```

## MCS值影响速率

LTE中速率的配置通过MCS（Modulation and Coding Scheme，调制与编码策略）索引值实现。MCS将所关注的影响通讯速率的因素作为表的列，将MCS索引作为行，形成一张速率表。所以，每一个MCS索引其实对应了一组参数下的物理传输速.这个值在分析的时候，越大越好

### QCAT查看

直接在QCAT中过滤`0xB16D`

```
   2017 Nov 16  03:24:41.850 [58] 0xB16D LTE GM TX Report
   Version = 18
   Number of Records = 20
   Tx Report Records[0] {
   Chan Type = PUSCH
   Modulation Type = QPSK
   MCS Index = 8
   }
```

