---
title: 信号质量分析
date: 2017-04-23 11:01:20
tags: android
categories:
    - 数据业务
    - 信号
password: 
---

场测问题经常需要分析当时的网络环境，不外乎就是信号质量，这里就记录下怎么查看信号质量，以及信号质量的标准

# 从AP层来看

## CDMA 信号强度查看

直接在`radio log`中搜索关键字`RIL_REQUEST_GET_CELL_INFO_LIST`，可以看到如下信息

```
11-04 09:57:00.410  2213  2285 D RILJ    : [8962]< RIL_REQUEST_GET_CELL_INFO_LIST [CellInfoCdma:{mRegistered=YES mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityCdma:{ mNetworkId=1 mSystemId=14259 mBasestationId=23366 mLongitude=1501170 mLatitude=336383} CellSignalStrengthCdma: cdmaDbm=-107 cdmaEcio=-125 evdoDbm=2147483647 evdoEcio=2147483647 evdoSnr=2147483647}, CellInfoLte:{mRegistered=YES mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=460 mMnc=11 mCi=182454067 mPci=271 mTac=44627 mEarfcn=1825} CellSignalStrengthLte: ss=26 rsrp=-87 rsrq=-6 rssnr=2147483647 cqi=2147483647 ta=0}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=270 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=22 rsrp=-103 rsrq=-20 rssnr=2147483647 cqi=2147483647 ta=2147483647}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=453 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=21 rsrp=-113 rsrq=-20 rssnr=2147483647 cqi=2147483647 ta=2147483647}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=209 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=21 rsrp=-105 rsrq=-20 rssnr=2147483647 cqi=2147483647 ta=2147483647}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=374 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=20 rsrp=-112 rsrq=-20 rssnr=2147483647 cqi=2147483647 ta=2147483647}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=266 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=14 rsrp=-114 rsrq=-18 rssnr=2147483647 cqi=2147483647 ta=2147483647}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=327 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=22 rsrp=-112 rsrq=-20 rssnr=2147483647 cqi=2147483647 ta=2147483647}, CellInfoLte:{mRegistered=NO mTimeStampType=oem_ril mTimeStamp=5849192931047ns CellIdentityLte:{ mMcc=2147483647 mMnc=2147483647 mCi=2147483647 mPci=272 mTac=2147483647 mEarfcn=1825} CellSignalStrengthLte: ss=23 rsrp=-103 rsrq=-20 rssnr=2147483647 cqi=2147483647 ta=2147483647}] [SUB0]
```
然后我们可以结合上面的内容跟代码，查看信号格数

`frameworks/base/telephony/java/android/telephony/SignalStrength.java`

```java
public int getCdmaLevel() {
    final int cdmaDbm = getCdmaDbm();
    final int cdmaEcio = getCdmaEcio();
    int levelDbm;
    int levelEcio;

    //信号强度
    if (cdmaDbm >= -75) levelDbm = SIGNAL_STRENGTH_GREAT;
    else if (cdmaDbm >= -85) levelDbm = SIGNAL_STRENGTH_GOOD;
    else if (cdmaDbm >= -95) levelDbm = SIGNAL_STRENGTH_MODERATE;
    else if (cdmaDbm >= -100) levelDbm = SIGNAL_STRENGTH_POOR;
    else levelDbm = SIGNAL_STRENGTH_NONE_OR_UNKNOWN;

    //信噪比
    // Ec/Io are in dB*10
    if (cdmaEcio >= -90) levelEcio = SIGNAL_STRENGTH_GREAT;
    else if (cdmaEcio >= -110) levelEcio = SIGNAL_STRENGTH_GOOD;
    else if (cdmaEcio >= -130) levelEcio = SIGNAL_STRENGTH_MODERATE;
    else if (cdmaEcio >= -150) levelEcio = SIGNAL_STRENGTH_POOR;
    else levelEcio = SIGNAL_STRENGTH_NONE_OR_UNKNOWN;

    if (DBG) log("getCdmaLevel=" + level);
    return level;
}

```

# 从modem 层来看

## GSM 下查看信号强度

### 通过QCAT进行查看

通过如下方法

```
GSM packets->0x51FC
```

```
//示例如下,含SERVING CELL和NEIGBOR CELL
2017 May 27  07:12:02.543  [E9]  0x51FC  GSM RR Cell Reselection Measmnts
	Serving Cell
	  BCCH ARFCN     : 96 (Band Class GSM 900)
	  PBCCH ARFCN    : 0
	  Priority Class : 0
	  RXLEV Average  : 26 (-84.5 dBm)//当前小区信号强度
	  C1  Value      : 14
	  C2  Value      : 14
	  C31 Value      : 0
	  C32 Value      : 0
	  5 Sec Timer State                : Stopped
	  Barred for reselection?          : No
	  Cell reselectn in last 15 sec's? : No
	  Number of Neighbor Cells         : 3
	  Neighbor Cell (0)
	     BCCH ARFCN     : 657 (Band Class DCS)
	     PBCCH ARFCN    : 0
	     Priority_Class : 0
	     RXLEV Average  : 9 (-101.5 dBm)//相邻小区信号强度
	     C1  Value      : -3
	     C2  Value      : 3
	     C31 Value      : 0
	     C32 Value      : 0
	     5 Sec Timer State             : Stopped
	     Barred for reselection?       : No
	     Belongs to serving cell's RA? : Yes
```

## LTE 下查看信号强度

## MTK
通过ELT工具查看

搜索关键字`store scell: earfcn`

```
3701404, 118773, 104544, 11:24:26:135 2017/11/16, MOD_ERRC_MOB, , TRACE_GROUP_1, [MRM] store scell: earfcn[38950] pci[248] rsrp2[-350] rssnr[124]

```

### 通过QCAT进行查找

打开文件后，按照如下截图中的操作，双击`LTE Inst Meas RSRP vs.Time`即可看到小区信息

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/lte_signal_1.png)


![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/lte_signal_2.png)

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/lte_signal_3.png)


## CDMA 下查看信号强度

### 通过QCAT进行查找

打开文件后，按照截图中的操作进行勾选

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/cdma_signal_1.png)

勾选`0x119D`、`0x119A`

然后点开筛选后的结果，如下


![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/cdma_signal_2.png)
