---
title: 高通紧急拨号预制
date: 2017-04-15 15:49:59
tags: android
categories:
    - 拨号
    - 紧急号码
password: 
---

最近新项目有个需求，就是需要预制紧急号码，查看了高通的文档才知道，跟紧急拨号相关的表格有8个，每个表格的作用文档是虽然有说明，但是解释的比较简单，所以打算结合着手机的实际效果进行验证、总结。8个表格对应的代码文件是`vendor/qcom/proprietary/qcril/qcril_database/qcril.sql`，对应手机中的数据库是`data/misc/radio/qcril.db`

# 真紧急跟假紧急号码区别

1. 假紧急走的是`voice`拨出，而真紧急就是`emergency`
2. 假紧急会直接拨到人工台，人工接听
3. 真紧急是拨到服务台

比如你把333作为460的真紧急号码，那么在国内拨打这个号码的话，会转到服务台，然后提示你拨打110、120等进行转接

# 相关的8个表格

紧急拨号相关的`TAB`一共有八个，每一个表都有不同的作用，比如有的是有卡紧急号码，有的是无卡紧急号码，有的是假紧急号码等。具体如下

## qcril_emergency_source_mcc_table

这个表格是根据国家码预制有卡紧急号码的，对应的代码内容如下

```java
CREATE TABLE qcril_emergency_source_mcc_table(MCC TEXT, NUMBER TEXT, IMS_ADDRESS TEXT, SERVICE TEXT, PRIMARY KEY(MCC,NUMBER));
INSERT INTO "qcril_emergency_source_mcc_table" VALUES('334','060','','');
INSERT INTO "qcril_emergency_source_mcc_table" VALUES('520','112','','limited');
```

对应的数据库表格如下

![pic alt](https://github.com/zsl-github/blog/raw/master/source/picture/qcril_emergency_source_mcc_table.png)

```
MCC    - 国家码
NUMBER - 号码
IMS_ADDRESS - 不清楚
SERVICE  - 根据网络状态进行紧急号码的匹配
```

这个表格是真紧急号码，走紧急号码的通道。这个表格，有一个关键字段，就是`SERVICE TEXT`，它有如下几个值

> limited

插卡情况下，手机处于`仅限紧急呼叫`状态，这时候是把预制的号码作为紧急号码，如果手机处于无服务状态，是作为普通号码呼出的

> full

插卡，无论处于什么状态，都是作为紧急号码处理

> NULL

好像加了这个，就无效了，什么状态下，都不能作为紧急号码

> 空

感觉这个效果跟`full`效果相同


## qcril_emergency_source_voice_table

根据`Mcc`来设置有卡假紧急号码，可以根据不同的网络状态设置不同的网络号码

代码中预制形式

```java
CREATE TABLE qcril_emergency_source_voice_table(MCC TEXT, NUMBER TEXT, IMS_ADDRESS TEXT, SERVICE TEXT, PRIMARY KEY(MCC,NUMBER));
INSERT INTO "qcril_emergency_source_voice_table" VALUES('460','110','','full');
INSERT INTO "qcril_emergency_source_voice_table" VALUES('460','119','','full');
```
它跟`qcril_emergency_source_mcc_table`几乎是一样的，唯一的区别是它走的是正常拨号流程

当两者同时配置的时候，好像有卡真紧急会覆盖假紧急，导致假紧急不生效



##
